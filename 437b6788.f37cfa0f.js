(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{115:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return b})),n.d(t,"default",(function(){return p}));var a=n(3),r=n(7),i=(n(0),n(231)),l=["components"],o={sidebar_label:"YM Notification Engine",title:"YM Notification Engine (v1.0.2)"},c={unversionedId:"platform_concepts/engagement/notification-engine",id:"platform_concepts/engagement/notification-engine",isDocsHomePage:!1,title:"YM Notification Engine (v1.0.2)",description:"Description",source:"@site/docs/platform_concepts/engagement/notification-engine.md",slug:"/platform_concepts/engagement/notification-engine",permalink:"/docs/platform_concepts/engagement/notification-engine",version:"current",sidebar_label:"YM Notification Engine",sidebar:"platform_concepts",previous:{title:"Understanding the Engage module",permalink:"/docs/platform_concepts/engagement/engage"},next:{title:"How to create and launch outbound WhatsApp notification campaigns?",permalink:"/docs/platform_concepts/engagement/outbound/whatsappCampaign"}},b=[{value:"Description",id:"description",children:[]},{value:"API Details",id:"api-details",children:[{value:"Authentication",id:"authentication",children:[]},{value:"Request body",id:"request-body",children:[]},{value:"Parameters",id:"parameters",children:[]},{value:"userDetails",id:"userdetails",children:[]},{value:"notification",id:"notification",children:[]},{value:"config",id:"config",children:[]},{value:"Response status codes:",id:"response-status-codes",children:[]},{value:"Postback webhook",id:"postback-webhook",children:[]},{value:"Support",id:"support",children:[]}]}],s={toc:b};function p(e){var t=e.components,n=Object(r.a)(e,l);return Object(i.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"description"},"Description"),Object(i.b)("p",null,"Notification Engine API offers capability to push dynamic content notification across to users on various channels."),Object(i.b)("p",null,"Key capabilities include:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"On demand notification delivery."),Object(i.b)("li",{parentName:"ol"},"Support for scheduling notifications."),Object(i.b)("li",{parentName:"ol"},"Support for postbacks on delivery updates."),Object(i.b)("li",{parentName:"ol"},"Reporting is available.")),Object(i.b)("h2",{id:"api-details"},"API Details"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Endpoint:")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"https://app.yellowmessenger.com/api/engagements/notifications/v1/push?bot=botID\n\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Method : "),"POST"),Object(i.b)("h3",{id:"authentication"},"Authentication"),Object(i.b)("p",null,"All requests to notification engine should be accompanied with this header."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},'{\n   "x-auth-token" : "token"\n}\n')),Object(i.b)("p",null,"*"," Token will be shared separately by the yellow.ai Team."),Object(i.b)("h3",{id:"request-body"},"Request body"),Object(i.b)("h3",{id:"parameters"},"Parameters"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Parameter Name"),Object(i.b)("th",{parentName:"tr",align:null},"Type"),Object(i.b)("th",{parentName:"tr",align:null},"Required"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"userDetails"),Object(i.b)("td",{parentName:"tr",align:null},"Object"),Object(i.b)("td",{parentName:"tr",align:null},"Yes"),Object(i.b)("td",{parentName:"tr",align:null},"Details of the user to be notified, Variables")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"notification"),Object(i.b)("td",{parentName:"tr",align:null},"Object"),Object(i.b)("td",{parentName:"tr",align:null},"Yes"),Object(i.b)("td",{parentName:"tr",align:null},"Template and Channel details.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"config"),Object(i.b)("td",{parentName:"tr",align:null},"Object"),Object(i.b)("td",{parentName:"tr",align:null},"Yes"),Object(i.b)("td",{parentName:"tr",align:null},"Metadata about the notification. Parameters like postBackUrl, customPayload etc can be specified.")))),Object(i.b)("h3",{id:"userdetails"},"userDetails"),Object(i.b)("p",null,"User details may contain all relevant information about the user. It needs to have atleast one contactable information and any number of additional parameters. For example, in case of voice notification, it needs to have a \u2018number\u2019 field mandatory and any number of extra parameters. It also contains the template parameters that needs to be rendered in the content."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},'   "userDetails": {\n       "number": "919876543210", //mandatory for sms, wa, voice     //country code to be added without space if not added default 91\n       "email": "abc@xyz.com", //mandatory for email\n       "fbId": "987543212", //mandatory for fbm\n   }\n')),Object(i.b)("h3",{id:"notification"},"notification"),Object(i.b)("p",null,"Notification contains the message template that needs to be sent as a notification. templateId is mandatory. templateId can be fetched Either it can contain the plain message directly or contain parameters to be rendered for a template on a particular channel. "),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n    "notification": {\n        "templateId": "emi-reminder-template01", // name of the template in YM portal. if template is created in waba, name of the template given there. mandatory for wa, sms(wherever applicable)\n        "params": { //renderable parameters defined in the template.\n            "EMI Value": "15000",\n            "First Name": "Wasim",\n            "media": {\n                "mediaLink": "mediaPublicUrl",\n                "title": "titleOfDoc"\n            } //applicable only for whatsapp \n        },\n        "freeTextContent": "Your content goes here", //if template is not renderable, notification engine will try to send this, subject to channel restrictions\n        "profileId": "kaleyra-sms", //set during channel-configuration. optional if only one profile\n        "type": "whatsapp", // channel type - whatsapp,sms,email,voice,fbmessenger\n        "sender": "919876543210",\n        "language": "en", // applicable for whatsapp\n        "namespace": "1bhjasd67123jjka", // applicable for whatsapp\n    }\n}\n')),Object(i.b)("h3",{id:"config"},"config"),Object(i.b)("p",null,"Channels is a list of channels the user needs to be notified on. Each element is in turn an object containing configuration about the channel."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'"config": {\n       "checkOptIn": "true", //  true/false. default value is false.\n       "scheduleAt": "1970-01-01T00:00:00.000Z", // Date time at which the notification should be sent. Default value is immediate. Max limit - 24 hours\n       "customPayload": { // Payload that will flow back to the postback webhook and reports.\n           "BUID": "asdasd", //Can add upto 3 custom reference parameters\n           "userID": "asdasd",\n           "departmentID": "67576q"\n       },\n       "checkOfficeHours":"true" //default value is true. working hours can be configured in portal\n   }\n')),Object(i.b)("p",null,"Currently metadata supports"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"scheduleAt :")," ISO formatted date time string at which the notification must be sent."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"customPayload :")," JSON object which will flow back to the postback URL if configured and also reflect in the reports. Can be used to associate identifying information for a particular notification."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"postBackURL :")," URL to send delivery post back.")),Object(i.b)("h3",{id:"response-status-codes"},"Response status codes:"),Object(i.b)("p",null,"On successful queueing of the notification, you will receive a 202 status code with the msgId."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"HTTP Status code"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"202"),Object(i.b)("td",{parentName:"tr",align:null},"Message queued successfully. You will receive a msgId for acknowledgement and tracking.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"400"),Object(i.b)("td",{parentName:"tr",align:null},"Bad request. Request structure is not formed correctly. Please check the \u2018message\u2019 field for more information.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"401"),Object(i.b)("td",{parentName:"tr",align:null},"Unauthorised. Please check your auth token.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"422"),Object(i.b)("td",{parentName:"tr",align:null},"Invalid inputs. The request structure is evaluated to be correct but the parameter values are not within expected range.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"429"),Object(i.b)("td",{parentName:"tr",align:null},"Rate limited. Occurs when there are too many requests. Please retry later.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},"500"),Object(i.b)("td",{parentName:"tr",align:null},"Internal server error. TraceId will be sent back for tracking.")))),Object(i.b)("h3",{id:"postback-webhook"},"Postback webhook"),Object(i.b)("p",null,"As soon as we receive callback from the downstream services, we will post that data to the configured webhook if available."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},'{\n   "msgId" : "AsdihS21_",\n   "userId" : "9876543210",        //This will be the contactable user info we notified on.\n   "customPayload" : {},\n   "event" : {\n       "status" : "delivered",\n       //Other channel specific parameters will be present\n   }\n}\n')),Object(i.b)("p",null,"Webhooks will be called with the above request body."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"},"customPayload: "),"This is the payload passed when queueing the notification.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"},"event: ")," event will always have the status field and additional fields depending on the channel and the status."),Object(i.b)("p",{parentName:"li"},"  Status can be one of the following."),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"queued/triggered"),Object(i.b)("li",{parentName:"ul"},"sent"),Object(i.b)("li",{parentName:"ul"},"delivered"),Object(i.b)("li",{parentName:"ul"},"acknowledged/read"),Object(i.b)("li",{parentName:"ul"},"failed")))),Object(i.b)("h3",{id:"support"},"Support"),Object(i.b)("p",null,"While raising any support issues, please add the msgId or the traceId in the support request."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Notes:")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"These are our outbound IPs. These need to be whitelisted for the reports callback to flow into your system.",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"13.71.52.164"),Object(i.b)("li",{parentName:"ul"},"13.71.49.46"))),Object(i.b)("li",{parentName:"ul"},"The messages will be acknowledged first and delivered at the scheduled time. Can be tracked by the msgId we send back.")))}p.isMDXComponent=!0},231:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b=r.a.createContext({}),s=function(e){var t=r.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=s(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,b=c(e,["components","mdxType","originalType","parentName"]),p=s(n),d=a,m=p["".concat(l,".").concat(d)]||p[d]||u[d]||i;return n?r.a.createElement(m,o(o({ref:t},b),{},{components:n})):r.a.createElement(m,o({ref:t},b))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=d;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var b=2;b<i;b++)l[b]=n[b];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);